<!DOCTYPE html>
<html>
<head>
    <style>
        .hidden {
            display: none;
        }

        .unhidden {
            display: inline-block;
        }

        .column {
            float: left;
            width: 45.00%;
            padding: 5px;
        }

        .row::after {
            content: "";
            clear: both;
            display: table;
        }

        .button {
            passing: 5px;
            width: 100%;
            height: 50px;
        }

        #button_next{
            width: 50%;
            float: right;
            height: 100%;
            padding: 5px;
            background: blanchedalmond;
        }
        #button_flip{
            width: 50%;
            float: left;
            height: 100%;
            padding: 5px;
            background: lightgray;
        }
        #button_back{
            width: 100%;
            height: 100%;
            padding: 5px;
            background: lightcyan;
        }
        .button_column {
            float: left;
            width: 23.00%;
            padding: 5px;
        }

        #button_reshuffle_batch{
            width: 100%;
            float: left;
            height: 100%;
            padding: 5px;
        }
        #button_next_batch{
            width: 100%;
            float: left;
            height: 100%;
            padding: 5px;
        }
        #button_deck_again{
            width: 100%;
            float: left;
            height: 100%;
            padding: 5px;
        }
        #main_menu{
            width: 100%;
            float: left;
            height: 100%;
            padding: 5px;
        }
    </style>
</head>
<body>

    <div>
        <div>
            <form name="batch_size" id="batch_size">
                <LABEL for="batch_size">Batch Size: </LABEL> <br>
                <input id="five" type="radio" name="batch_size" value="five"> 5 <br>
                <input id="ten" type="radio" name="batch_size" value="ten"> 10 <br>
                <input id="all" type="radio" name="batch_size" value="all" checked> Entire Deck <br> <br>
            </form>
        </div>
        <div>
            <p id="output"></p>
        </div>
    </div>


    <div class="card_control">
        <div class="button">
            <button id="button_back" label="OK" class="hidden"/>Previous Card</button>
        </div>
        <div class="row">
            <div class="column">
                <img id="image" style="width:100%">
            </div>
            <div class="column">
                <img id="image_hidden" class="hidden" style="width:100%">
            </div>
        </div>
        <div class="button">
            <button id="button_flip" label="OK"/>Flip</button>
            <button id="button_next" label="OK" class="unhidden"/>Next Card</button>
        </div>
    </div>

    <div>
        <div class="button">
            <div class="button_column">
                <button id="button_reshuffle_batch" label="OK" class="hidden"/>Practice Batch Again</button>
            </div>
            <div class="button_column">
                <button id="button_next_batch" label="OK" class="hidden"/>Next Batch</button>
            </div>
            <div class="button_column">
                <button id="button_deck_again" class="hidden">Practice Deck Again</button>
            </div>
            <div class="button_column">
                <button id="main_menu" onclick="window.location.href='/'">Main Menu</button>
            </div>
        </div>
    </div>

<script>
    cards_ordered = {{cards | tojson}}
    var cards_shuffled
    var cards
    var index = 0
    var batch_index = 0

//    todo: start here
    document.getElementById('output').innerHTML = index;

    function shuffle(array) {
        var currentIndex = array.length, temporaryValue, randomIndex;

        // While there remain elements to shuffle...
        while (0 !== currentIndex) {

        // Pick a remaining element...
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex -= 1;

        // And swap it with the current element.
        temporaryValue = array[currentIndex];
        array[currentIndex] = array[randomIndex];
        array[randomIndex] = temporaryValue;
        }
        return array;
    }
    cards_shuffled = shuffle(cards_ordered)
    cards = cards_shuffled

    document.getElementById("image").src = cards[index][0];

    document.addEventListener('DOMContentLoaded', init, false);
    function init(){
        function flip () {
            document.getElementById("image_hidden").src = cards[index][1];
            var image = document.getElementById('image_hidden');
            image.className = "unhidden"

            if (cards.length == index + 1) {
                document.getElementById('button_reshuffle_batch').className = "unhidden"
                if (((cards_ordered.length / batch_size | 0) == batch_index) | ((cards_ordered.length % batch_size == 0) & ((cards_ordered.length / batch_size | 0) == batch_index + 1))) {
                    document.getElementById('button_deck_again').className = "unhidden"
                }
            }
        }
        var button_flip = document.getElementById('button_flip');
        button_flip.addEventListener('click', flip, true);


        function next () {
            index++;
            var image = document.getElementById('image_hidden');
            if (image.className == "unhidden") {
                image.className = "hidden"
            }
            document.getElementById("image").src = cards[index][0];

            var button_back = document.getElementById('button_back');
            if (index == 1) {
                button_back.className = "unhidden"
            }
            if (index == (cards.length - 1)) {
                button_next.className = "hidden"
            }
        }
        var button_next = document.getElementById('button_next');
        button_next.addEventListener('click', next, true);


        function back () {
            index--;
            var image = document.getElementById('image_hidden');
            if (image.className == "unhidden") {
                image.className = "hidden"
            }
            document.getElementById("image").src = cards[index][0];

            var button_next = document.getElementById('button_next');
            if (index == (cards.length - 2)) {
                button_next.className = "unhidden"
            }
            if (index == 0) {
                button_back.className = "hidden"
            }
        }
        var button_back = document.getElementById('button_back');
        button_back.addEventListener('click', back, true);


        var radios = document.forms["batch_size"].elements["batch_size"];
        for(var i = 0, max = radios.length; i < max; i++) {
            radios[i].onclick = function() {
                if (this.value == "five") {
                    cards = shuffle(cards_ordered).slice(0, 5)
                    document.getElementById('button_next_batch').className = "unhidden"
                }
                else if (this.value == "ten") {
                    cards = shuffle(cards_ordered).slice(0, 10)
                    document.getElementById('button_next_batch').className = "unhidden"
                }
                else {
                    cards = shuffle(cards_ordered)
                }
                index = 0
                batch_index = 0
                document.getElementById("image").src = cards[index][0];
                document.getElementById('button_next').className = "unhidden"
                document.getElementById('button_back').className = "hidden"
            }
        }


        function reshuffle () {
            cards = shuffle(cards)
            index = 0
            document.getElementById("image").src = cards[index][0];
            document.getElementById('button_next').className = "unhidden"
            document.getElementById('button_back').className = "hidden"
            document.getElementById('button_reshuffle_batch').className = "hidden"
            document.getElementById('image_hidden').className = "hidden"
        }
        var button_reshuffle = document.getElementById('button_reshuffle_batch');
        button_reshuffle.addEventListener('click', reshuffle, true);


        function getRadioVal(form, name) {
            var val;
            // get list of radio buttons with specified name
            var radios = form.elements[name];

            // loop through list of radio buttons
            for (var i=0, len=radios.length; i<len; i++) {
                if ( radios[i].checked ) { // radio checked?
                    val = radios[i].value; // if so, hold its value in val
                    break; // and break out of for loop
                }
            }
            return val; // return value of checked radio or undefined if none checked
        }

        function val_converter(value) {
            if (value == "five") {
                return 5
            }
            else if (value == "ten") {
                return 10
            }
            else {
                return 0
            }
        }


        function next_batch () {
            batch_index++
            batch_size = val_converter(getRadioVal(document.getElementById('batch_size'), 'batch_size'))
            cards = cards_shuffled.slice(batch_size * batch_index, batch_size * (batch_index + 1))
            index = 0
            document.getElementById("image").src = cards[index][0];
            document.getElementById('button_next').className = "unhidden"
            document.getElementById('button_back').className = "hidden"
            document.getElementById('image_hidden').className = "hidden"
            document.getElementById('button_reshuffle_batch').className = "hidden"
            if (((cards_ordered.length / batch_size | 0) == batch_index) | ((cards_ordered.length % batch_size == 0) & ((cards_ordered.length / batch_size | 0) == batch_index + 1))) {
                document.getElementById('button_next_batch').className = "hidden"
            }
        }
        var button_next_batch= document.getElementById('button_next_batch');
        button_next_batch.addEventListener('click', next_batch, true);


        function deck_again () {
            index=0
            batch_index=0
            cards = cards_ordered

            document.getElementById("all").checked = true
            document.getElementById("image").src = cards[index][0];
            document.getElementById('image_hidden').className = "hidden"
            document.getElementById('button_next').className = "unhidden"
            document.getElementById('button_back').className = "hidden"
            document.getElementById('button_reshuffle_batch').className = "hidden"
            document.getElementById('button_deck_again').className = "hidden"
        }
        var button_deck_again = document.getElementById('button_deck_again');
        button_deck_again.addEventListener('click', deck_again, true);


    };
</script>



</body>
</html>

<!--todo: counter/cards done and left in batch and batches left-->
<!--todo: should probably add keystrokes to flip and arrows to go to next and back-->


<!--todo: incorporate the separate js file...I can't figure out how to do it, for some reason-->
<!--todo: merge into master-->
<!--todo: how can I make this easy for them to start?-->
<!--todo: I think I can pretty easily write a bash script that will start things up. But can I make something that is clickable?-->
<!--todo: I think maybe I want him to just run the bash script-->



<!--todo: make quiz...it shouldn't be too hard either-->
